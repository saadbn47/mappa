<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorateur Immobilier - Bordeaux M√©tropole</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
        #header { background: #0056b3; color: white; padding: 15px; text-align: center; font-size: 22px; }
        #tabs { display: flex; justify-content: center; background: #eee; padding: 10px; }
        .tab { padding: 10px 20px; cursor: pointer; margin: 0 10px; background: white; border: 1px solid #ccc; }
        .tab:hover, .active-tab { background: #ddd; }
        .tab-content { display: none; padding: 20px; }
        .active { display: block; }
        .container { display: flex; }
        #map { height: 400px; width: 60%; margin-right: 20px; border: 1px solid #ccc; }
        #stats-panel { width: 35%; padding: 10px; background: #f4f4f4; }
        .stats-container { display: flex; justify-content: space-around; margin-top: 20px; }
        .stat-box { background: #fff; padding: 15px; border-radius: 5px; text-align: center; width: 100%; margin-bottom: 10px; }
        canvas { width: 100% !important; height: 300px !important; }
    </style>
</head>
<body>
    <div id="header">Explorateur de Donn√©es de l'Immobilier - Bordeaux M√©tropole</div>
    
    <div id="tabs">
        <div class="tab active-tab" onclick="showTab('carte')">üó∫Ô∏è Carte Interactive</div>
    </div>
    
    <div id="carte" class="tab-content active">
        <h3>Carte Interactive</h3>
        <div class="container">
            <div id="map"></div>
            <div id="stats-panel">
                <h4>Donn√©es du quartier s√©lectionn√©</h4>
                <div id="selected-stats"></div>
                <canvas id="priceChart"></canvas>
            </div>
        </div>
    </div>
    
    <script>
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active-tab'));
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`[onclick="showTab('${tabId}')"]`).classList.add('active-tab');
            if (tabId === 'carte') {
                setTimeout(() => { map.invalidateSize(); }, 300);
            }
        }

        var map = L.map('map').setView([44.8378, -0.5792], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        fetch('bordeaux_data.geojson')
            .then(response => response.json())
            .then(data => {
                data.features.forEach(feature => {
                    var coordinates = feature.geometry.coordinates;
                    var properties = feature.properties;
                    var marker = L.marker([coordinates[1], coordinates[0]]).addTo(map);
                    
                    marker.bindTooltip(
                        `<b>${properties.nom_quartier}</b><br>
                        ${properties.adresse}<br>
                        Prix m¬≤ 2021: ${properties.prix_m2_2021}‚Ç¨<br>
                        Prix m¬≤ 2022: ${properties.prix_m2_2022}‚Ç¨<br>
                        Prix m¬≤ 2023: ${properties.prix_m2_2023}‚Ç¨<br>
                        Pr√©diction 2024: ${properties.pred_m2_2024}‚Ç¨<br>
                        Prix m¬≤ 2024: ${properties.prix_m2_2024}‚Ç¨`,
                        { permanent: false, direction: "top" }
                    );

                    marker.on('click', function() {
                        document.getElementById('selected-stats').innerHTML = `
                            <b>${properties.nom_quartier}</b><br>
                            ${properties.adresse}<br>
                            Prix m¬≤ 2021: ${properties.prix_m2_2021}‚Ç¨<br>
                            Prix m¬≤ 2022: ${properties.prix_m2_2022}‚Ç¨<br>
                            Prix m¬≤ 2023: ${properties.prix_m2_2023}‚Ç¨<br>
                            Pr√©diction 2024: ${properties.pred_m2_2024}‚Ç¨<br>
                            Prix m¬≤ 2024: ${properties.prix_m2_2024}‚Ç¨`;

                        updateChart([2021, 2022, 2023, 'Pred 2024', 2024], 
                                    [properties.prix_m2_2021, properties.prix_m2_2022, properties.prix_m2_2023, properties.pred_m2_2024, properties.prix_m2_2024]);
                    });
                });
            });

        function updateChart(labels, data) {
            var ctx = document.getElementById('priceChart').getContext('2d');
            if (window.priceChartInstance) {
                window.priceChartInstance.destroy();
            }
            window.priceChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{ 
                        label: '√âvolution des prix',
                        data: data,
                        borderColor: ['blue', 'blue', 'blue', 'red', 'green'],
                        fill: false
                    }]
                }
            });
        }
    </script>
</body>
</html>